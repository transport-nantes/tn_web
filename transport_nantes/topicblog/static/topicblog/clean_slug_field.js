function slugify(id) {
    var slug = $('#' + id).val();
    slug = slug.toLowerCase()
               .replace(/^[-_\s]+/g, '')
               .replace(/[-_\s]+/g, '-')
               .replace(/[^\w-]/g, '');
    $('#' + id).val(slug);
}

const SLUG_FIELDS_IDS = JSON.parse(document.getElementById('slug_fields').textContent);

for (var slug_field_id of SLUG_FIELDS_IDS) {
    // The leading "id_" is generated by Django Crispy Forms.
    $("#id_" + slug_field_id).on('input', function() {
        slugify(this.id);
    });
    $("#id_" + slug_field_id).on('change', function() {
        if (this.value.slice(-1) === '-') {
            this.value = this.value.slice(0, -1);
        }
    });
}
