{% comment %}
Requires a MobilitoSession as 'session'

The parent must load edit_username_in_place.js to have the edit
username feature to work.
Importing it there would load the script multiple times, attaching
multiple event listeners to the same elements.

This is meant to be a reusable component.
{% endcomment %}
{% load absolute_url %}

<div class="w-100 h-100 py-2" >
    <article
      style="
        border: 1px solid hsla(0, 0%, 0%, 0.5);
        border-radius: 5px;
        box-shadow: inset 0 1px 0 hsl(219, 24%, 45%), 0 1px 3px hsla(0, 0%, 0%, 0.2);
        padding: 1.25rem;
      "
      class="d-flex flex-column h-100"
    >
      <h2 style="font-size: 1.2em;">
        <a href="{{ session.get_absolute_url }}" style="color: inherit">
          <i class="fa-solid fa-crosshairs"></i>
          {{ session.location|default:"Pas d'adresse" }}
        </a>
      </h2>
      <div class="mt-auto">
        <p class="m-0" style="word-wrap:anywhere;">
          <i>
            <a
              href="{% url 'mobilito:user_sessions' session.user.user.username %}"
              style="color: inherit; font-size: 0.9rem"
            >
              <u id="displayed-username_{{ session.session_sha1 }}">
                {{ session.user.user.username }}
              </u>
            </a>
          </i>
          {% if session.user.user == request.user %}
            <i id="mobilito-username-edit-btn_{{ session.session_sha1 }}" class="fa-solid fa-pen ml-3 white-hover" style='font-size:smaller;'></i>
            <form
              id="mobilito-username-edit-form_{{ session.session_sha1 }}"
              method="post"
              action="{% url 'asso_tn:edit_username' request.user.username %}"
              class="d-none justify-content-center flex-wrap col-12 px-0"
              data-current-username="{{ request.user.username }}"
            >
              {% csrf_token %}
              <div class="d-flex form-group col-12 pl-0">
                <input
                  type="text"
                  class="d-flex my-auto in-place-edit-input"
                  id="mobilito-username-input_{{ session.session_sha1 }}"
                  name="username"
                  value="{{ request.user.username }}"
                  maxlength="1000"
                  size="15"
                />
                <div id="button-holder" class="d-flex">
                  <button
                    type="submit"
                    id="edit-username-submit-btn_{{ session.session_sha1 }}"
                    class="btn donation-button m-2"
                  >
                    <i class="fas fa-check"></i>
                  </button>
                  <button
                    type="button"
                    class="btn navigation-button my-2 my-lg-auto"
                    id="mobilito-username-cancel-btn_{{ session.session_sha1 }}"
                  >
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                </div>
              </div>
            </form>

          {% endif %}
        </p>
        <p class="mb-3"><i>{{ session.start_timestamp|date:"d/m/Y Ã  H:i" }}</i></p>
        {% if session.map_image %}
          <div style="height: 200px; max-width: 100%" class="p-2 p-sm-0">
              <img
              src="{% absolute_url_image session.map_image.url %}"
              alt="Emplacement de la session"
              class="w-100"
              style="
                  object-fit: cover;
                  border-radius: 5px;
                  max-width: 100%;
                  max-height: 100%;
              "
              />
          </div>
        {% endif %}
      </div>
    </article>
</div>
